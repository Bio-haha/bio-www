<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bio World Wide Web — Living Chaos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#020204}
canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let w,h;
function resize(){w=canvas.width=innerWidth;h=canvas.height=innerHeight}
addEventListener('resize',resize);resize();

/* ===== TIME ===== */
let age=0, phase=0;

/* ===== AUDIO ===== */
const A = new (AudioContext||webkitAudioContext)();
const master=A.createGain();
master.gain.value=0.35;
master.connect(A.destination);

function noiseNode(){
  const b=A.createBuffer(1,A.sampleRate*2,A.sampleRate);
  const d=b.getChannelData(0);
  for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
  const s=A.createBufferSource();
  s.buffer=b; s.loop=true;
  return s;
}

const voices=[];
for(let i=0;i<16;i++){
  const o=A.createOscillator();
  const n=noiseNode();
  const f=A.createBiquadFilter();
  const g=A.createGain();
  o.type='sawtooth';
  o.frequency.value=30+i*18;
  f.type='bandpass';
  g.gain.value=0;
  o.connect(f); n.connect(f);
  f.connect(g).connect(master);
  o.start(); n.start();
  voices.push({o,f,g,seed:Math.random()*10});
}

/* ===== FIELD ===== */
const scale=14;
let cols,rows,angle=[],dens=[];
function buildField(){
  cols=(w/scale)|0; rows=(h/scale)|0;
  angle=[...Array(cols)].map(()=>Array(rows).fill(0));
  dens=[...Array(cols)].map(()=>Array(rows).fill(0));
}
buildField();

function updateField(t){
  const drift=Math.sin(t*0.00003+age)*0.6;
  for(let x=0;x<cols;x++){
    for(let y=0;y<rows;y++){
      const nx=x*0.16+drift, ny=y*0.16-drift;
      const mut=Math.sin(age*2+x*0.02)*0.6;
      const a=
        Math.sin(nx+t*0.00035+mut)+
        Math.cos(ny-t*0.0003-mut);
      const n=Math.sin(nx*ny*0.025+t*0.00025);
      angle[x][y]=a+n*3;
      dens[x][y]=Math.abs(n);
    }
  }
}

/* ===== NODES ===== */
class Node{
  constructor(){
    this.x=Math.random()*w;
    this.y=Math.random()*h;
    this.vx=0; this.vy=0;
    this.h=Math.random()*360;
  }
  move(){
    const ix=(this.x/scale)|0, iy=(this.y/scale)|0;
    const a=(angle[ix]&&angle[ix][iy])||0;
    const d=(dens[ix]&&dens[ix][iy])||0;
    this.vx+=Math.cos(a)*(0.08+d*0.25);
    this.vy+=Math.sin(a)*(0.08+d*0.25);
    this.vx+=Math.sin(this.y*0.01+age)*0.3;
    this.vy+=Math.cos(this.x*0.01-age)*0.3;
    this.vx*=0.92; this.vy*=0.92;
    this.x=(this.x+this.vx+w)%w;
    this.y=(this.y+this.vy+h)%h;
  }
} 
  function nearestNode(x,y){
  let m=1e9, t=null;
  for(const n of nodes){
    const dx=n.x-x, dy=n.y-y;
    const d=dx*dx+dy*dy;
    if(d<m){ m=d; t=n; }
  }
  return t;
}

let nodes=[...Array(520)].map(()=>new Node()); 
for(let i=0;i<6;i++) createSpike(); 

/* ===== COLONIES ===== */
let colonies=[];
class Colony{
  constructor(){
    this.x=Math.random()*w;
    this.y=Math.random()*h;
    this.mass=10;
    this.energy=1;
    this.age=0;
    this.branches=[];
    this.h=80+Math.random()*100;
  }
  grow(){
    this.age++;
    this.energy+=0.02-Math.sin(age*0.1)*0.015;
    if(Math.random()<this.energy*0.02 && this.branches.length<50){
      this.branches.push({a:Math.random()*Math.PI*2,l:2});
    }
    this.mass+=this.energy*0.04;
    if(this.energy<0.2) this.mass*=0.995;
  }
  draw(){
    ctx.strokeStyle=`hsla(${this.h},100%,60%,0.25)`;
    ctx.lineWidth=0.6;
    this.branches.forEach(b=>{
      b.l+=this.energy*0.4;
      const ex=this.x+Math.cos(b.a)*b.l;
      const ey=this.y+Math.sin(b.a)*b.l;
      ctx.beginPath();
      ctx.moveTo(this.x,this.y);
      ctx.lineTo(ex,ey);
      ctx.stroke();
      nodes.forEach(n=>{
        const dx=n.x-ex, dy=n.y-ey;
        const d=Math.hypot(dx,dy);
        if(d<70){n.vx+=dx*0.0002;n.vy+=dy*0.0002}
      });
    });
  }
  dead(){return this.mass<3||this.age>9000}
}

/* ===== SIGNALS ===== */
let signals=[];
  /* ===== SPIKES (FUNGAL TENDRILS) ===== */
const spikes=[];

function createSpike(){
  const n = nodes[Math.floor(Math.random()*nodes.length)];
  const s = {
    head:{ x:n.x, y:n.y, vx:0, vy:0 },
    body:[],
    target:null,
    life:600+Math.random()*1200
  };
  for(let i=0;i<18;i++) s.body.push({x:s.head.x,y:s.head.y});
  spikes.push(s);
}

function emit(a,b){
  signals.push({a,b,t:0,v:0.01+Math.random()*0.05,h:Math.random()*360});
}

/* ===== LOOP ===== */
function loop(t){
  age+=0.00002;
  phase*=0.995;
  if(Math.random()<0.0005) phase=1;

  ctx.fillStyle='rgba(2,2,4,0.25)';
  ctx.fillRect(0,0,w,h);

  updateField(t);
  nodes.forEach(n=>n.move());

  // network
  for(let i=0;i<nodes.length;i++){
    for(let j=i+1;j<nodes.length;j++){
      const A1=nodes[i],B1=nodes[j];
      const dx=A1.x-B1.x, dy=A1.y-B1.y;
      const d=Math.hypot(dx,dy);
      if(d<170){
        ctx.strokeStyle=`hsla(${(A1.h+B1.h)/2},100%,75%,0.06)`;
        ctx.lineWidth=0.45;
        ctx.beginPath();
        ctx.moveTo(A1.x,A1.y);
        ctx.lineTo(B1.x,B1.y);
        ctx.stroke();
        if(Math.random()<0.001) emit(A1,B1);
      }
    }
  }
//Tambahan Spike For Each
  spikes.forEach(s=>{
  ctx.beginPath();
  ctx.moveTo(s.head.x,s.head.y);
  s.body.forEach(b=>ctx.lineTo(b.x,b.y));
  ctx.strokeStyle='rgba(40,255,120,0.45)';
  ctx.lineWidth=1;
  ctx.stroke();
});

  // colonies
  if(Math.random()<0.0003 && colonies.length<7) colonies.push(new Colony());
  colonies.forEach(c=>{c.grow();c.draw()});
  colonies=colonies.filter(c=>!c.dead()); 

  // Spike Metabolism
spikes.forEach(s=>{
  s.life--;
  if(s.life<0){
    s.target=null;
    s.life=400+Math.random()*1000;
  }

  if(!s.target || Math.random()<0.004){
    s.target=nearestNode(s.head.x,s.head.y);
  }

  if(s.target){
    const dx=s.target.x-s.head.x;
    const dy=s.target.y-s.head.y;
    s.head.vx+=dx*0.0018;
    s.head.vy+=dy*0.0018;
  }

  s.head.vx*=0.91;
  s.head.vy*=0.91;
  s.head.x+=s.head.vx;
  s.head.y+=s.head.vy;

  let px=s.head.x, py=s.head.y;
  s.body.forEach(b=>{
    const dx=px-b.x, dy=py-b.y;
    const d=Math.hypot(dx,dy)||1;
    const k=(d-9)/d;
    b.x+=dx*k*0.7;
    b.y+=dy*k*0.7;
    px=b.x; py=b.y;
  });
});

  // signals
  signals.forEach(s=>{
    s.t+=s.v;
    const x=s.a.x+(s.b.x-s.a.x)*s.t;
    const y=s.a.y+(s.b.y-s.a.y)*s.t;
    ctx.strokeStyle=`hsla(${s.h},100%,85%,0.8)`;
    ctx.lineWidth=1.5;
    ctx.beginPath();
    ctx.arc(x,y,2.5,0,Math.PI*2);
    ctx.stroke();
  });
  signals=signals.filter(s=>s.t<1); 

  // audio
  const chaos=Math.min(signals.length/20,1.5);
  voices.forEach((v,i)=>{
    v.o.frequency.setTargetAtTime(
      40+i*20+chaos*800*Math.sin(t*0.001+v.seed),
      A.currentTime,0.12
    );
    v.f.frequency.setTargetAtTime(
      300+chaos*5000,
      A.currentTime,0.15
    );
    v.g.gain.setTargetAtTime(
      chaos*0.03,
      A.currentTime,0.2
    );
  });

  ctx.fillStyle='rgba(180,220,255,0.45)';
  ctx.font='12px monospace';
  ctx.fillText('BIO WORLD WIDE WEB — Living Microscopic Network',12,h-14);

  requestAnimationFrame(loop);
}

document.body.onclick=()=>A.resume();
loop(0);
</script>
</body>
</html>
