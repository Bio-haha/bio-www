<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bio World Wide Web — Installation Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #020204;
}
canvas { display:block; }
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
/* =====================================================
   BIO WORLD WIDE WEB — INSTALLATION MODE
   A + B + CHAOS EXTENDED
   ===================================================== */

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let w,h;
function resize(){ w=canvas.width=innerWidth; h=canvas.height=innerHeight; }
addEventListener('resize',resize); resize();

/* ===== AUDIO ===== */
const A=new (AudioContext||webkitAudioContext)();
const master=A.createGain();
master.gain.value=0.25;
master.connect(A.destination);

function noiseNode(){
  const b=A.createBuffer(1,A.sampleRate*2,A.sampleRate);
  const d=b.getChannelData(0);
  for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
  const s=A.createBufferSource();
  s.buffer=b; s.loop=true;
  return s;
}

const voices=[];
for(let i=0;i<14;i++){
  const o=A.createOscillator();
  const n=noiseNode();
  const f=A.createBiquadFilter();
  const g=A.createGain();
  o.type='sawtooth';
  o.frequency.value=30+i*18;
  f.type='bandpass';
  g.gain.value=0;
  o.connect(f); n.connect(f);
  f.connect(g).connect(master);
  o.start(); n.start();
  voices.push({o,f,g,seed:Math.random()});
}

/* ===== FIELD ===== */
const scale=16;
let cols,rows,angle=[],dens=[];
function buildField(){
  cols=(w/scale)|0; rows=(h/scale)|0;
  angle=[...Array(cols)].map(()=>Array(rows).fill(0));
  dens=[...Array(cols)].map(()=>Array(rows).fill(0));
}
buildField();

function updateField(t){
  for(let x=0;x<cols;x++){
    for(let y=0;y<rows;y++){
      const nx=x*0.14, ny=y*0.14;
      const a=Math.sin(nx+t*0.0003)+Math.cos(ny-t*0.00025);
      const n=Math.sin((nx*ny)*0.03+t*0.0002);
      angle[x][y]=a+n*2.4;
      dens[x][y]=Math.abs(n);
    }
  }
}

/* ===== NETWORK NODES ===== */
class Node{
  constructor(){
    this.x=Math.random()*w;
    this.y=Math.random()*h;
    this.vx=0; this.vy=0;
    this.h=Math.random()*360;
  }
  move(){
    const ix=(this.x/scale)|0, iy=(this.y/scale)|0;
    const a=(angle[ix]&&angle[ix][iy])||0;
    const d=(dens[ix]&&dens[ix][iy])||0;
    this.vx+=Math.cos(a)*(0.12+d*0.45);
    this.vy+=Math.sin(a)*(0.12+d*0.45);
    this.vx*=0.93; this.vy*=0.93;
    this.x=(this.x+this.vx+w)%w;
    this.y=(this.y+this.vy+h)%h;
  }
}

let nodes=[...Array(420)].map(()=>new Node());

/* ===== SIGNAL FLOW ===== */
let signals=[];
function emit(a,b){
  signals.push({
    a,b,t:0,
    h:Math.random()*360,
    v:0.015+Math.random()*0.03
  });
}

/* ===== LOOP ===== */
function loop(t){
  ctx.fillStyle='rgba(2,2,4,0.14)';
  ctx.fillRect(0,0,w,h);

  updateField(t);
  nodes.forEach(n=>n.move());

  // NETWORK
  for(let i=0;i<nodes.length;i++){
    for(let j=i+1;j<nodes.length;j++){
      const A1=nodes[i], B1=nodes[j];
      const dx=A1.x-B1.x, dy=A1.y-B1.y;
      const d=Math.hypot(dx,dy);
      if(d<160){
        ctx.strokeStyle=`hsla(${(A1.h+B1.h)/2},100%,70%,0.06)`;
        ctx.lineWidth=0.5;
        ctx.beginPath();
        ctx.moveTo(A1.x,A1.y);
        ctx.lineTo(B1.x,B1.y);
        ctx.stroke();
        if(Math.random()<0.0009) emit(A1,B1);
      }
    }
  }

  // SIGNAL FLOW
  signals.forEach(s=>{
    s.t+=s.v;
    const x=s.a.x+(s.b.x-s.a.x)*s.t;
    const y=s.a.y+(s.b.y-s.a.y)*s.t;
    ctx.strokeStyle=`hsla(${s.h},100%,80%,0.7)`;
    ctx.lineWidth=1.2;
    ctx.beginPath();
    ctx.arc(x,y,2.8,0,Math.PI*2);
    ctx.stroke();
  });
  signals=signals.filter(s=>s.t<1);

  // AUDIO COUPLING
  const chaos=Math.min(signals.length/30,1.2);
  voices.forEach((v,i)=>{
    v.o.frequency.setTargetAtTime(
      40+i*22+chaos*600*Math.sin(t*0.001+v.seed),
      A.currentTime,0.12
    );
    v.f.frequency.setTargetAtTime(
      300+chaos*4200,
      A.currentTime,0.15
    );
    v.g.gain.setTargetAtTime(
      chaos*(0.03+Math.random()*0.06),
      A.currentTime,0.18
    );
  });

  ctx.fillStyle='rgba(180,220,255,0.4)';
  ctx.font='12px monospace';
  ctx.fillText('BIO WORLD WIDE WEB — Microscopic Chaotic Network',12,h-14);

  requestAnimationFrame(loop);
}

document.body.onclick=()=>A.resume();
loop(0);
</script>
</body>
</html>
