<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bio World Wide Web — Installation Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #020204;
}
canvas {
  display: block;
}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
/* =====================================================
   BIO WORLD WIDE WEB — INSTALLATION MODE
   Plant Microscopic · Fluorescent · Audio-Visual Organism
   ===================================================== */

/* ===== Canvas ===== */
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let w, h;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

/* ===== Climate (Indonesia / fallback-safe) ===== */
let climate = { temp: 30, humidity: 70, wind: 1.5 };
async function fetchClimate() {
  try {
    const r = await fetch('https://api.open-meteo.com/v1/forecast?latitude=-6.2&longitude=106.8&current=temperature_2m,relative_humidity_2m,wind_speed_10m');
    const d = await r.json();
    climate.temp = d.current.temperature_2m;
    climate.humidity = d.current.relative_humidity_2m;
    climate.wind = d.current.wind_speed_10m;
  } catch(e) {}
}
fetchClimate();
setInterval(fetchClimate, 10 * 60 * 1000);

/* ===== Audio (Installation Grade) ===== */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();
const master = audioCtx.createGain();
master.gain.value = 0.4;
master.connect(audioCtx.destination);

const osc = audioCtx.createOscillator();
const noise = audioCtx.createBufferSource();
const filter = audioCtx.createBiquadFilter();
filter.type = 'lowpass';
filter.frequency.value = 800;

osc.type = 'sine';
osc.frequency.value = 120;

const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 2, audioCtx.sampleRate);
const data = noiseBuffer.getChannelData(0);
for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
noise.buffer = noiseBuffer;
noise.loop = true;

osc.connect(filter);
noise.connect(filter);
filter.connect(master);
osc.start();
noise.start();

/* ===== Flow Field (Plant Microscopic) ===== */
const scale = 30;
let field = { scale, cols: 0, rows: 0, v: [] };

function buildField() {
  field.cols = Math.floor(w / scale);
  field.rows = Math.floor(h / scale);
  field.v = Array.from({ length: field.cols }, () => Array(field.rows).fill(0));
}
buildField();

function updateField(t) {
  for (let x = 0; x < field.cols; x++) {
    for (let y = 0; y < field.rows; y++) {
      const nx = x * 0.1;
      const ny = y * 0.1;
      field.v[x][y] = Math.sin(nx + t * 0.0002) + Math.cos(ny + t * 0.00015);
    }
  }
}

/* ===== Fibers ===== */
class Fiber {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.vx = 0;
    this.vy = 0;
    this.life = 400 + Math.random() * 400;
    this.hue = Math.random() * 360;
  }
  step() {
    const ix = Math.floor(this.x / field.scale);
    const iy = Math.floor(this.y / field.scale);
    const a = (field.v[ix] && field.v[ix][iy]);
    if (a !== undefined) {
      this.vx += Math.cos(a) * 0.08;
      this.vy += Math.sin(a) * 0.08;
    }
    this.vx *= 0.97;
    this.vy *= 0.97;
    const px = this.x;
    const py = this.y;
    this.x += this.vx;
    this.y += this.vy;
    ctx.beginPath();
    ctx.moveTo(px, py);
    ctx.lineTo(this.x, this.y);
    ctx.strokeStyle = `hsla(${this.hue},90%,65%,0.22)`;
    ctx.lineWidth = 0.4;
    ctx.stroke();
    this.life--;
  }
}

let fibers = [];
for (let i = 0; i < 1200; i++) fibers.push(new Fiber(Math.random()*w, Math.random()*h));

/* ===== Loop ===== */
function loop(t) {
  ctx.fillStyle = 'rgba(2,2,4,0.08)';
  ctx.fillRect(0,0,w,h);

  updateField(t);

  let activity = 0;
  fibers.forEach(f => {
    f.step();
    activity += Math.abs(f.vx) + Math.abs(f.vy);
  });

  fibers = fibers.filter(f => f.life > 0);
  while (fibers.length < 1500) fibers.push(new Fiber(Math.random()*w, Math.random()*h));

  /* Audio follows visual tension */
  const density = Math.min(activity / 4000, 1);
  osc.frequency.setTargetAtTime(80 + density * 300, audioCtx.currentTime, 0.1);
  filter.frequency.setTargetAtTime(400 + density * 2000, audioCtx.currentTime, 0.1);
  master.gain.setTargetAtTime(0.2 + density * 0.4, audioCtx.currentTime, 0.1);

  requestAnimationFrame(loop);
}

/* ===== Start ===== */
document.body.addEventListener('click', () => {
  if (audioCtx.state !== 'running') audioCtx.resume();
});
loop(0);
</script>
</body>
</html>
